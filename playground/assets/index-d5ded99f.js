import{d as s,e as D,l as I,r as Q,i as $}from"./index-3342bd04.js";import{y as _,h as C,z as p,s as V,i as z,m as W}from"./index-43b61fac.js";import{u as X}from"./index-6b019601.js";function Y(L,A={}){const{current:x,changed:h,add:i,remove:d,nameTemplate:E=n=>`${n}`}=A,f=_(()=>Array.isArray(s(L))?s(L).filter(n=>!!s(n.layer)).map((n,l)=>{const a=p(s(n.layer));return{name:n.name??E(l+1,a),layer:p(s(n.layer)),overlay:!1}}):[]),u=_(()=>{const n=s(x);if(n==null)return null;const a=D(n)?f.value[n]:f.value.find(t=>t.name===n);return!a||!s(a.layer)?null:{name:a.name,layer:p(s(a.layer)),overlay:!1}});return h&&C(f,n=>{h(n)},{deep:!0}),(i||d)&&C(u,(n,l)=>{l&&(d==null||d(l)),n&&(i==null||i(n))}),{layers:f,currentLayer:u}}function Z(L,A={}){const{current:x,changed:h,add:i,remove:d,nameTemplate:E=a=>`${a}`}=A,f=_(()=>Array.isArray(s(L))?s(L).filter(a=>!!s(a.layer)).map((a,t)=>{const y=p(s(a.layer));return{name:a.name??E(t+1,y),layer:p(s(a.layer)),overlay:!0}}):[]),u=_(()=>{const a=s(x);if(!Array.isArray(a))return[];const t=[];for(const y of a){let c;D(y)&&f.value[y]?c=f.value[y]:c=f.value.find(m=>m.name===y),c&&s(c.layer)&&t.push({name:c.name,layer:p(s(c.layer)),overlay:!0})}return t});h&&C(f,a=>{h(a)},{deep:!0}),(i||d)&&C(()=>[...u.value],(a,t)=>{const y=l(a,t,n),c=l(t,a,n);d&&c.forEach(m=>d(m)),i&&y.forEach(m=>i(m))},{deep:!0});function n(a,t){return I.Util.stamp(a.layer)===I.Util.stamp(t.layer)}function l(a,t,y){return a.filter(c=>!t.some(m=>y(c,m)))}return{layers:f,currentLayers:u}}function ne(L,A={}){const{currentBaseLayer:x,currentOverlays:h,indexes:i=!1,factory:d,dispose:E=!0,...f}=A,u=V(null),n=z(x),l=z(h),a=Q(L),{layers:t,currentLayer:y}=Y(_(()=>{var e;return(e=a.value)==null?void 0:e.filter(({overlay:r})=>!r)}),{current:n,changed:e=>b(e,!1),add:e=>g(e.layer),remove:e=>U(e.layer)}),{layers:c,currentLayers:m}=Z(_(()=>{var e;return(e=a.value)==null?void 0:e.filter(({overlay:r})=>r)}),{current:l,changed:e=>b(e,!0),add:e=>g(e.layer),remove:e=>U(e.layer)});function H(){const e=d?d(f):new I.Control.Layers(void 0,void 0,f);u.value=W(S(e))}function N(){b(t.value,!1),b(c.value,!0)}function S(e){const r=e.onAdd,o=e.onRemove;return e.onAdd=v=>{const O=r.call(e,v);return q(v),j(v),O},e.onRemove=v=>{o.call(e,v),G(v)},e}function j(e){y.value&&g(y.value.layer,e),m.value.forEach(({layer:r})=>g(r,e))}function q(e){e.on("baselayerchange",k).on("overlayadd",w).on("overlayremove",T)}function G(e){e.off("baselayerchange",k).off("overlayadd",w).off("overlayremove",T)}function k(e){i?n.value=B(t.value,e.layer):n.value=e.name}function w(e){if($(l)||(l.value=[]),i){const r=B(c.value,e.layer),o=l.value;r!==void 0&&!o.includes(r)&&o.push(r)}else{const r=l.value;!r.includes(e.name)&&r.push(e.name)}}function T(e){if($(l)||(l.value=[]),i){const r=l.value,o=B(c.value,e.layer);o!==void 0&&F(r,o)}else{const r=l.value;F(r,e.name)}}function b(e,r){K(r),J(e),P()}function J(e){e.forEach(r=>{var o;(o=u.value)==null||o._addLayer(r.layer,r.name,r.overlay)})}function K(e){const r=u.value,o=r._layers,v=[],O=[];o.forEach(R=>{R.overlay?O.push(R):v.push(R)}),(e?O:v).forEach(R=>{var M;(M=R.layer)==null||M.off("add remove",r._onLayerChange,r)}),r._layers=[...e?v:O]}function P(){const e=u.value;e!=null&&e._map&&e._update()}function g(e,r){var o;r=r??((o=u.value)==null?void 0:o._map),r&&!r.hasLayer(e)&&r.addLayer(e)}function U(e,r){var o;r=r??((o=u.value)==null?void 0:o._map),r&&r.hasLayer(e)&&r.removeLayer(e)}function B(e,r){const o=e.findIndex(v=>v.layer===r);return o>-1?o:void 0}function F(e,r){const o=e.indexOf(r);o>-1&&e.splice(o,1)}return X(u,{dispose:E}),H(),N(),u}export{ne as u};
