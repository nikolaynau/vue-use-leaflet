import{b as s,t as N,i as $}from"./index-XMFbUhFf.js";import{p as _,h as C,n as h,l as I,s as P,i as D,m as Q}from"./index-sEMHmT-4.js";import{u as W}from"./index-0mMaD078.js";function X(p,A={}){const{current:x,changed:L,add:i,remove:d,nameTemplate:E=n=>`${n}`}=A,f=_(()=>Array.isArray(s(p))?s(p).filter(n=>!!s(n.layer)).map((n,t)=>{const a=h(s(n.layer));return{name:n.name??E(t+1,a),layer:h(s(n.layer)),overlay:!1}}):[]),u=_(()=>{const n=s(x);if(n==null)return null;const a=typeof n=="number"?f.value[n]:f.value.find(l=>l.name===n);return!a||!s(a.layer)?null:{name:a.name,layer:h(s(a.layer)),overlay:!1}});return L&&C(f,n=>{L(n)},{deep:!0}),(i||d)&&C(u,(n,t)=>{t&&(d==null||d(t)),n&&(i==null||i(n))}),{layers:f,currentLayer:u}}function Y(p,A={}){const{current:x,changed:L,add:i,remove:d,nameTemplate:E=a=>`${a}`}=A,f=_(()=>Array.isArray(s(p))?s(p).filter(a=>!!s(a.layer)).map((a,l)=>{const y=h(s(a.layer));return{name:a.name??E(l+1,y),layer:h(s(a.layer)),overlay:!0}}):[]),u=_(()=>{const a=s(x);if(!Array.isArray(a))return[];const l=[];for(const y of a){let c;typeof y=="number"&&f.value[y]?c=f.value[y]:c=f.value.find(m=>m.name===y),c&&s(c.layer)&&l.push({name:c.name,layer:h(s(c.layer)),overlay:!0})}return l});L&&C(f,a=>{L(a)},{deep:!0}),(i||d)&&C(()=>[...u.value],(a,l)=>{const y=t(a,l,n),c=t(l,a,n);d&&c.forEach(m=>d(m)),i&&y.forEach(m=>i(m))},{deep:!0});function n(a,l){return I.Util.stamp(a.layer)===I.Util.stamp(l.layer)}function t(a,l,y){return a.filter(c=>!l.some(m=>y(c,m)))}return{layers:f,currentLayers:u}}function ae(p,A={}){const{currentBaseLayer:x,currentOverlays:L,indexes:i=!1,factory:d,dispose:E=!0,...f}=A,u=P(null),n=D(x),t=D(L),a=N(p),{layers:l,currentLayer:y}=X(_(()=>{var e;return(e=a.value)==null?void 0:e.filter(({overlay:r})=>!r)}),{current:n,changed:e=>R(e,!1),add:e=>g(e.layer),remove:e=>F(e.layer)}),{layers:c,currentLayers:m}=Y(_(()=>{var e;return(e=a.value)==null?void 0:e.filter(({overlay:r})=>r)}),{current:t,changed:e=>R(e,!0),add:e=>g(e.layer),remove:e=>F(e.layer)});function H(){const e=d?d(f):new I.Control.Layers(void 0,void 0,f);u.value=Q(V(e))}function S(){R(l.value,!1),R(c.value,!0)}function V(e){const r=e.onAdd,o=e.onRemove;return e.onAdd=v=>{const O=r.call(e,v);return q(v),j(v),O},e.onRemove=v=>{o.call(e,v),z(v)},e}function j(e){y.value&&g(y.value.layer,e),m.value.forEach(({layer:r})=>g(r,e))}function q(e){e.on("baselayerchange",k).on("overlayadd",w).on("overlayremove",T)}function z(e){e.off("baselayerchange",k).off("overlayadd",w).off("overlayremove",T)}function k(e){i?n.value=B(l.value,e.layer):n.value=e.name}function w(e){if($(t)||(t.value=[]),i){const r=B(c.value,e.layer),o=t.value;r!==void 0&&!o.includes(r)&&o.push(r)}else{const r=t.value;!r.includes(e.name)&&r.push(e.name)}}function T(e){if($(t)||(t.value=[]),i){const r=t.value,o=B(c.value,e.layer);o!==void 0&&M(r,o)}else{const r=t.value;M(r,e.name)}}function R(e,r){J(r),G(e),K()}function G(e){e.forEach(r=>{var o;(o=u.value)==null||o._addLayer(r.layer,r.name,r.overlay)})}function J(e){const r=u.value,o=r._layers,v=[],O=[];o.forEach(b=>{b.overlay?O.push(b):v.push(b)}),(e?O:v).forEach(b=>{var U;(U=b.layer)==null||U.off("add remove",r._onLayerChange,r)}),r._layers=[...e?v:O]}function K(){const e=u.value;e!=null&&e._map&&e._update()}function g(e,r){var o;r=r??((o=u.value)==null?void 0:o._map),r&&!r.hasLayer(e)&&r.addLayer(e)}function F(e,r){var o;r=r??((o=u.value)==null?void 0:o._map),r&&r.hasLayer(e)&&r.removeLayer(e)}function B(e,r){const o=e.findIndex(v=>v.layer===r);return o>-1?o:void 0}function M(e,r){const o=e.indexOf(r);o>-1&&e.splice(o,1)}return W(u,{dispose:E}),H(),S(),u}export{ae as u};
