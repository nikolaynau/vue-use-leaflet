import{d as t,e as z,r as P,l as Q,i as M}from"./index-3c2b32e6.js";import{y as _,h as g,z as h,s as V,i as $,m as W}from"./index-4806f730.js";import{u as X}from"./index-3afbeb48.js";function Y(m,p={}){const{current:A,changed:L,add:f,remove:i,nameTemplate:x=n=>`${n}`}=p,c=_(()=>Array.isArray(t(m))?t(m).filter(n=>!!t(n.layer)).map((n,a)=>{const l=h(t(n.layer));return{name:n.name??x(a+1,l),layer:h(t(n.layer)),overlay:!1}}):[]),u=_(()=>{const n=t(A);if(n==null)return null;const l=z(n)?c.value[n]:c.value.find(s=>s.name===n);return!l||!t(l.layer)?null:{name:l.name,layer:h(t(l.layer)),overlay:!1}});return L&&g(c,n=>{L(n)},{deep:!0}),(f||i)&&g(u,(n,a)=>{a&&(i==null||i(a)),n&&(f==null||f(n))}),{layers:c,currentLayer:u}}function Z(m,p={}){const{current:A,changed:L,add:f,remove:i,nameTemplate:x=a=>`${a}`}=p,c=_(()=>Array.isArray(t(m))?t(m).filter(a=>!!t(a.layer)).map((a,l)=>{const s=h(t(a.layer));return{name:a.name??x(l+1,s),layer:h(t(a.layer)),overlay:!0}}):[]),u=_(()=>{const a=t(A);if(!Array.isArray(a))return[];const l=[];for(const s of a){let v;z(s)&&c.value[s]?v=c.value[s]:v=c.value.find(d=>d.name===s),v&&t(v.layer)&&l.push({name:v.name,layer:h(t(v.layer)),overlay:!0})}return l});L&&g(c,a=>{L(a)},{deep:!0}),(f||i)&&g(()=>[...u.value],(a,l)=>{const s=n(a,l),v=n(l,a);i&&v.forEach(d=>i(d)),f&&s.forEach(d=>f(d))},{deep:!0});function n(a,l){return a.filter(s=>!l.includes(s))}return{layers:c,currentLayers:u}}function ne(m,p={}){const{currentBaseLayer:A,currentOverlays:L,indexes:f=!1,factory:i,dispose:x=!0,...c}=p,u=V(null),n=$(A),a=$(L),l=P(m),{layers:s,currentLayer:v}=Y(_(()=>{var e;return(e=l.value)==null?void 0:e.filter(({overlay:r})=>!r)}),{current:n,changed:e=>R(e,!1),add:e=>b(e.layer),remove:e=>w(e.layer)}),{layers:d,currentLayers:D}=Z(_(()=>{var e;return(e=l.value)==null?void 0:e.filter(({overlay:r})=>r)}),{current:a,changed:e=>R(e,!0),add:e=>b(e.layer),remove:e=>w(e.layer)});function H(){const e=i?i(c):new Q.Control.Layers(void 0,void 0,c);u.value=W(S(e))}function N(){R(s.value,!1),R(d.value,!0)}function S(e){const r=e.onAdd,o=e.onRemove;return e.onAdd=y=>{const E=r.call(e,y);return j(y),U(y),E},e.onRemove=y=>{o.call(e,y),q(y)},e}function U(e){v.value&&b(v.value.layer,e),D.value.forEach(({layer:r})=>b(r,e))}function j(e){e.on("baselayerchange",B).on("overlayadd",I).on("overlayremove",k)}function q(e){e.off("baselayerchange",B).off("overlayadd",I).off("overlayremove",k)}function B(e){f?n.value=C(s.value,e.layer):n.value=e.name}function I(e){if(M(a)||(a.value=[]),f){const r=C(d.value,e.layer),o=a.value;r!==void 0&&!o.includes(r)&&o.push(r)}else{const r=a.value;!r.includes(e.name)&&r.push(e.name)}}function k(e){if(M(a)||(a.value=[]),f){const r=a.value,o=C(d.value,e.layer);o!==void 0&&T(r,o)}else{const r=a.value;T(r,e.name)}}function R(e,r){J(r),G(e),K()}function G(e){e.forEach(r=>{var o;(o=u.value)==null||o._addLayer(r.layer,r.name,r.overlay)})}function J(e){const r=u.value,o=r._layers,y=[],E=[];o.forEach(O=>{O.overlay?E.push(O):y.push(O)}),(e?E:y).forEach(O=>{var F;(F=O.layer)==null||F.off("add remove",r._onLayerChange,r)}),r._layers=[...e?y:E]}function K(){const e=u.value;e!=null&&e._map&&e._update()}function b(e,r){var o;r=r??((o=u.value)==null?void 0:o._map),r&&!r.hasLayer(e)&&r.addLayer(e)}function w(e,r){var o;r=r??((o=u.value)==null?void 0:o._map),r&&r.hasLayer(e)&&r.removeLayer(e)}function C(e,r){const o=e.findIndex(y=>y.layer===r);return o>-1?o:void 0}function T(e,r){const o=e.indexOf(r);o>-1&&e.splice(o,1)}return X(u,{dispose:x}),H(),N(),u}export{ne as u};
